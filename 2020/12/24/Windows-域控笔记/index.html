<!DOCTYPE html>












  


<html class="theme-next pisces use-motion" lang="zh-CN">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2"/>
<meta name="theme-color" content="#222">












<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />






















<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=6.3.0" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=6.3.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=6.3.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=6.3.0">


  <link rel="mask-icon" href="/images/logo.svg?v=6.3.0" color="#222">









<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '6.3.0',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="本篇介绍一些基础概念和相关知识">
<meta property="og:type" content="article">
<meta property="og:title" content="Windows 域控笔记">
<meta property="og:url" content="http://sup817ch.github.io/2020/12/24/Windows-域控笔记/index.html">
<meta property="og:site_name" content="sup817ch&#39;s blog">
<meta property="og:description" content="本篇介绍一些基础概念和相关知识">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="https://blogvaronis2.wpengine.com/wp-content/uploads/2018/12/what-can-mimikatz-do@2x-1-960x669.png">
<meta property="og:updated_time" content="2021-01-08T02:27:03.784Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Windows 域控笔记">
<meta name="twitter:description" content="本篇介绍一些基础概念和相关知识">
<meta name="twitter:image" content="https://blogvaronis2.wpengine.com/wp-content/uploads/2018/12/what-can-mimikatz-do@2x-1-960x669.png">






  <link rel="canonical" href="http://sup817ch.github.io/2020/12/24/Windows-域控笔记/"/>



<script type="text/javascript" id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>Windows 域控笔记 | sup817ch's blog</title>
  









  <noscript>
  <style type="text/css">
    .use-motion .motion-element,
    .use-motion .brand,
    .use-motion .menu-item,
    .sidebar-inner,
    .use-motion .post-block,
    .use-motion .pagination,
    .use-motion .comments,
    .use-motion .post-header,
    .use-motion .post-body,
    .use-motion .collection-title { opacity: initial; }

    .use-motion .logo,
    .use-motion .site-title,
    .use-motion .site-subtitle {
      opacity: initial;
      top: initial;
    }

    .use-motion {
      .logo-line-before i { left: initial; }
      .logo-line-after i { right: initial; }
    }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">sup817ch's blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">
    <a href="/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-home"></i> <br />首页</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-about">
    <a href="/about/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-user"></i> <br />关于</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">
    <a href="/archives/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />归档</a>
  </li>

      
      
    </ul>
  

  

  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://sup817ch.github.io/2020/12/24/Windows-域控笔记/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="sup817ch">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="sup817ch's blog">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">Windows 域控笔记
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2020-12-24 11:09:26" itemprop="dateCreated datePublished" datetime="2020-12-24T11:09:26+08:00">2020-12-24</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2021-01-08 10:27:03" itemprop="dateModified" datetime="2021-01-08T10:27:03+08:00">2021-01-08</time>
              
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>本篇介绍一些基础概念和相关知识</p>
<a id="more"></a>
<h1 id="什么是域？"><a href="#什么是域？" class="headerlink" title="什么是域？"></a>什么是域？</h1><p>Windows域通常用于大型网络——公司网络、学校网络和政府网络。除非你有雇主或学校提供的笔记本电脑，否则你在家里不会遇到这种情况。</p>
<p>典型的家用计算机是一个孤立的实体。您可以控制计算机上的设置和用户帐户。连接到域的计算机是不同的——这些设置是在<strong>域控制器(DC, domain controller)</strong> 上控制的。</p>
<p>Windows域为网络管理员提供了一种方法来管理大量的pc机，并从一个地方控制它们。一个或多个服务器(称为域控制器)控制域及其上的计算机。</p>
<p>域通常由在同一本地网络上的计算机组成。但是，连接到某个域的计算机可以通过VPN或Internet连接继续与域控制器通信。这使得企业和学校能够远程管理他们提供给员工和学生的笔记本电脑。</p>
<p>当计算机连接到一个域时，它不会使用自己的本地用户帐户，用户帐户和密码都是在域控制器上统一管理。当您登录到该域中的计算机时，计算机将使用域控制器验证您的用户帐户名称和密码。这意味着您可以在任何连接到该域的计算机上使用相同的用户名和密码登录。</p>
<p>网络管理员可以更改“域控制器”上的组策略设置。域上的每台计算机将从“域控制器”获得这些设置，它们将覆盖用户在其pc上指定的任何本地设置。所有的设置都是从一个地方控制的。这也“锁定”了计算机。您可能不允许更改连接到域的计算机上的许多系统设置。</p>
<h1 id="域环境搭建"><a href="#域环境搭建" class="headerlink" title="域环境搭建"></a>域环境搭建</h1><p><a href="http://blog.sina.com.cn/s/blog_6ce0f2c901014okt.html" target="_blank" rel="noopener">http://blog.sina.com.cn/s/blog_6ce0f2c901014okt.html</a></p>
<p><a href="http://www.it165.net/os/html/201306/5493.html" target="_blank" rel="noopener">http://www.it165.net/os/html/201306/5493.html</a></p>
<h1 id="Windows安全认证机制"><a href="#Windows安全认证机制" class="headerlink" title="Windows安全认证机制"></a>Windows安全认证机制</h1><p>Windows安全认证机制主要有两种：NTLM和Kerberos</p>
<p>基于ntlm的认证方式,主要用在早期的windows工作组环境中,认证的过程也相对比较简单。</p>
<p>另一种是基于Kerberos的认证方式,主要用在域环境中。</p>
<p><a href="https://zh.wikipedia.org/wiki/Windows_2000" target="_blank" rel="noopener">Windows 2000</a>和后续的操作系统使用Kerberos为其默认认证方法。<a href="https://tools.ietf.org/html/rfc3244" target="_blank" rel="noopener">RFC 3244</a> “微软Windows 2000 Kerberos变更密码与设置密码协议” 记录整理一些<a href="https://zh.wikipedia.org/wiki/微软" target="_blank" rel="noopener">微软</a>对Kerberos协议软件包的添加。<a href="https://tools.ietf.org/html/rfc4757" target="_blank" rel="noopener">RFC 4757</a> 记录整理微软对<a href="https://zh.wikipedia.org/wiki/RC4" target="_blank" rel="noopener">RC4</a>密码的使用。虽然微软使用Kerberos协议，却并没有用麻省理工的软件。</p>
<h2 id="维基"><a href="#维基" class="headerlink" title="维基"></a>维基</h2><p><a href="https://en.wikipedia.org/wiki/NT_LAN_Manager" target="_blank" rel="noopener">https://en.wikipedia.org/wiki/NT_LAN_Manager</a></p>
<p><a href="https://zh.wikipedia.org/wiki/Kerberos" target="_blank" rel="noopener">https://zh.wikipedia.org/wiki/Kerberos</a></p>
<h2 id="其他资料"><a href="#其他资料" class="headerlink" title="其他资料"></a>其他资料</h2><p><a href="https://www.zhihu.com/question/22177404" target="_blank" rel="noopener">能用通用的语言介绍下 Kerberos 协议么？</a>（通俗解释）</p>
<p><a href="https://www.varonis.com/blog/kerberos-authentication-explained/" target="_blank" rel="noopener">Kerberos Authentication Explained</a></p>
<p><a href="https://blog.csdn.net/wulantian/article/details/42418231" target="_blank" rel="noopener">kerberos认证原理</a></p>
<p><a href="https://attack.mitre.org/techniques/T1558/" target="_blank" rel="noopener">Steal or Forge Kerberos Tickets</a> （对Kerberos的一些攻击方式）</p>
<p><a href="https://www.cnblogs.com/artech/archive/2011/01/24/kerberos.html" target="_blank" rel="noopener">Windows安全认证是如何进行的？[Kerberos篇]</a></p>
<p><a href="https://www.cnblogs.com/artech/archive/2011/01/25/NTLM.html" target="_blank" rel="noopener">Windows安全认证是如何进行的？[NTLM篇]</a></p>
<p><a href="https://daiker.gitbook.io/windows-protocol/" target="_blank" rel="noopener">windows protocol</a>（对Kerberos、NTLM、LDAP的一些介绍，比较详细，可以多看看）</p>
<h1 id="Mimikatz"><a href="#Mimikatz" class="headerlink" title="Mimikatz"></a>Mimikatz</h1><p>Mimikatz是一款开源应用程序，允许用户查看和保存Kerberos tickets之类的身份验证凭据。本杰明·德尔皮（Benjamin Delpy）继续领导Mimikatz的开发，因此该工具集可与当前版本的Windows配合使用，并包括最新的攻击。</p>
<h2 id="Mimikatz能做什么"><a href="#Mimikatz能做什么" class="headerlink" title="Mimikatz能做什么"></a>Mimikatz能做什么</h2><ul>
<li><strong>Pass-the-Hash:</strong> Windows used to <a href="https://www.varonis.com/blog/windows-10-authentication-the-end-of-pass-the-hash/" target="_blank" rel="noopener">store password data in an NTLM hash</a>. Attackers use Mimikatz to pass that exact hash string to the target computer to login. Attackers don’t even need to crack the password, they just need to use the hash string as is. It’s the equivalent of finding the master key to a building on the floor. You need that one key to get into all the doors.</li>
<li><strong>Pass-the-Ticket:</strong> Newer versions of windows store password data in a construct called a ticket.  Mimikatz provides functionality for a user to pass a kerberos ticket to another computer and login with that user’s ticket. It’s basically the same as pass-the-hash otherwise.</li>
<li><strong>Over-Pass the Hash (Pass the Key):</strong> Yet another flavor of the pass-the-hash, but this technique passes a unique key to impersonate a user you can obtain from a domain controller.</li>
<li><strong>Kerberos Golden Ticket:</strong> This is a pass-the-ticket attack, but it’s a specific ticket for a hidden account called KRBTGT, which is the account that encrypts all of the other tickets. A <a href="https://www.varonis.com/blog/kerberos-how-to-stop-golden-tickets/" target="_blank" rel="noopener">golden ticket</a> gives you domain admin credentials to any computer on the network that doesn’t expire.</li>
<li><strong>Kerberos Silver Ticket:</strong> Another pass-the-ticket, but a <a href="https://www.varonis.com/blog/kerberos-attack-silver-ticket/" target="_blank" rel="noopener">silver ticket</a> takes advantage of a feature in Windows that makes it easy for you to use services on the network. Kerberos grants a user a TGS ticket, and a user can use that ticket to log into any services on the network. Microsoft doesn’t always check a TGS after it’s issued, so it’s easy to slip it past any safeguards.</li>
<li><strong>Pass-the-Cache:</strong> Finally an attack that doesn’t take advantage of Windows! A pass-the-cache attack is generally the same as a pass-the-ticket, but this one uses the saved and encrypted login data on a Mac/UNIX/Linux system.</li>
</ul>
<p><img src="https://blogvaronis2.wpengine.com/wp-content/uploads/2018/12/what-can-mimikatz-do@2x-1-960x669.png" alt=""></p>
<h2 id="Mimikatz-github"><a href="#Mimikatz-github" class="headerlink" title="Mimikatz github"></a>Mimikatz github</h2><p><a href="https://github.com/gentilkiwi/mimikatz" target="_blank" rel="noopener">https://github.com/gentilkiwi/mimikatz</a></p>
<h2 id="其他资料-1"><a href="#其他资料-1" class="headerlink" title="其他资料"></a>其他资料</h2><p><a href="https://www.varonis.com/blog/what-is-mimikatz/" target="_blank" rel="noopener">What is Mimikatz: The Beginner’s Guide</a></p>
<p><a href="https://www.cnblogs.com/-mo-/p/11890232.html" target="_blank" rel="noopener">[后渗透]Mimikatz使用大全</a></p>
<p><a href="https://www.freebuf.com/articles/web/176796.html" target="_blank" rel="noopener">九种姿势运行Mimikatz</a>（包含了一些绕过杀软的手段）</p>
<p><a href="https://www.anquanke.com/post/id/180126" target="_blank" rel="noopener">深入分析Mimikatz：WDigest</a></p>
<p><a href="https://www.anquanke.com/post/id/180001" target="_blank" rel="noopener">深入分析Mimikatz：SSP</a></p>
<p><a href="https://www.freebuf.com/articles/terminal/80186.html" target="_blank" rel="noopener">刨根问底：Hash传递攻击原理探究</a></p>
<p><a href="https://adsecurity.org/?page_id=1821" target="_blank" rel="noopener">Unofficial Guide to Mimikatz &amp; Command Reference</a>（介绍了mimikatz的使用方法和检测方法）</p>
<h1 id="LDAP"><a href="#LDAP" class="headerlink" title="LDAP"></a>LDAP</h1><h2 id="什么是LDAP"><a href="#什么是LDAP" class="headerlink" title="什么是LDAP"></a>什么是LDAP</h2><p>轻量目录访问协议（Lightweight Directory Access Protocol）是直接运行在TCP/IP栈上的目录服务协议，LDAP有关联的API可以简化编写互联网目录服务应用程序的过程。LDAP一般使用在企业内部用于保存员工信息和组织架构，同时可以作为个人电脑以及应用系统的统一认证和登录。</p>
<h2 id="Searching-a-Directory"><a href="#Searching-a-Directory" class="headerlink" title="Searching a Directory"></a>Searching a Directory</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">//----------------------------------------------</span></span><br><span class="line"><span class="comment">// Performing an LDAP Synchronous Search.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Be aware that you must set the command prompt screen buffer </span></span><br><span class="line"><span class="comment">// height to 350 and the width to 90.</span></span><br><span class="line"><span class="comment">//-------------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;winldap.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;winber.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;rpc.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;rpcdce.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> comment(lib,<span class="meta-string">"Wldap32.lib"</span>)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//-----------------------------------------------------------</span></span><br><span class="line"><span class="comment">// This subroutine must have validated credentials (name and</span></span><br><span class="line"><span class="comment">// password) passed to it.</span></span><br><span class="line"><span class="comment">//-----------------------------------------------------------</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">MyLDAPSearch</span><span class="params">(PCHAR pUserName, PCHAR pPassword)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//---------------------------------------------------------</span></span><br><span class="line">    <span class="comment">// Initialize a session. LDAP_PORT is the default port, 389.</span></span><br><span class="line">    <span class="comment">//---------------------------------------------------------</span></span><br><span class="line">    PCHAR hostName = <span class="string">"corp.vantasy.com"</span>;</span><br><span class="line">    LDAP* pLdapConnection = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">    pLdapConnection = ldap_initA(hostName, LDAP_PORT);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (pLdapConnection == <span class="literal">NULL</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"ldap_init failed with 0x%x.\n"</span>, LdapGetLastError());</span><br><span class="line">        ldap_unbind(pLdapConnection);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"ldap_init succeeded \n"</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//-------------------------------------------------------</span></span><br><span class="line">    <span class="comment">// Set session options.</span></span><br><span class="line">    <span class="comment">//-------------------------------------------------------</span></span><br><span class="line">    ULONG version = LDAP_VERSION3;</span><br><span class="line">    ULONG numReturns = <span class="number">10</span>;</span><br><span class="line">    ULONG lRtn = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Set the version to 3.0 (default is 2.0).</span></span><br><span class="line">    lRtn = ldap_set_option(</span><br><span class="line">        pLdapConnection,           <span class="comment">// Session handle</span></span><br><span class="line">        LDAP_OPT_PROTOCOL_VERSION, <span class="comment">// Option</span></span><br><span class="line">        (<span class="keyword">void</span>*)&amp;version);         <span class="comment">// Option value</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (lRtn == LDAP_SUCCESS)</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"ldap version set to 3.0 \n"</span>);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"SetOption Error:%0lX\n"</span>, lRtn);</span><br><span class="line">        ldap_unbind(pLdapConnection);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Set the limit on the number of entries returned to 10.</span></span><br><span class="line">    lRtn = ldap_set_option(</span><br><span class="line">        pLdapConnection,       <span class="comment">// Session handle</span></span><br><span class="line">        LDAP_OPT_SIZELIMIT,    <span class="comment">// Option</span></span><br><span class="line">        (<span class="keyword">void</span>*)&amp;numReturns);  <span class="comment">// Option value</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (lRtn == LDAP_SUCCESS)</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"Max return entries set to 10 \n"</span>);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"SetOption Error:%0lX\n"</span>, lRtn);</span><br><span class="line">        ldap_unbind(pLdapConnection);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//--------------------------------------------------------</span></span><br><span class="line">    <span class="comment">// Connect to the server.</span></span><br><span class="line">    <span class="comment">//--------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line">    lRtn = ldap_connect(pLdapConnection, <span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (lRtn == LDAP_SUCCESS)</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"ldap_connect succeeded \n"</span>);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"ldap_connect failed with 0x%lx.\n"</span>, lRtn);</span><br><span class="line">        ldap_unbind(pLdapConnection);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//--------------------------------------------------------</span></span><br><span class="line">    <span class="comment">// Bind with credentials.</span></span><br><span class="line">    <span class="comment">//--------------------------------------------------------</span></span><br><span class="line">    PCHAR pMyDN = <span class="string">"DC=corp,DC=vantasy,DC=com"</span>;</span><br><span class="line">    SEC_WINNT_AUTH_IDENTITY_A secIdent;</span><br><span class="line"></span><br><span class="line">    secIdent.User = (<span class="keyword">unsigned</span> <span class="keyword">char</span>*)pUserName;</span><br><span class="line">    secIdent.UserLength = <span class="built_in">strlen</span>(pUserName);</span><br><span class="line">    secIdent.Password = (<span class="keyword">unsigned</span> <span class="keyword">char</span>*)pPassword;</span><br><span class="line">    secIdent.PasswordLength = <span class="built_in">strlen</span>(pPassword);</span><br><span class="line">    secIdent.Domain = (<span class="keyword">unsigned</span> <span class="keyword">char</span>*)hostName;</span><br><span class="line">    secIdent.DomainLength = <span class="built_in">strlen</span>(hostName);</span><br><span class="line">    secIdent.Flags = SEC_WINNT_AUTH_IDENTITY_ANSI;</span><br><span class="line"></span><br><span class="line">    lRtn = ldap_bind_sA(</span><br><span class="line">        pLdapConnection,      <span class="comment">// Session Handle</span></span><br><span class="line">        pMyDN,                <span class="comment">// Domain DN</span></span><br><span class="line">        (PCHAR)&amp;secIdent,     <span class="comment">// Credential structure</span></span><br><span class="line">        LDAP_AUTH_NEGOTIATE); <span class="comment">// Auth mode</span></span><br><span class="line">    <span class="keyword">if</span> (lRtn == LDAP_SUCCESS)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"ldap_bind_s succeeded \n"</span>);</span><br><span class="line">        secIdent.Password = <span class="literal">NULL</span>; <span class="comment">// Remove password pointer</span></span><br><span class="line">        pPassword = <span class="literal">NULL</span>;         <span class="comment">// Remove password pointer</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"ldap_bind_s failed with 0x%lx.\n"</span>, lRtn);</span><br><span class="line">        ldap_unbind(pLdapConnection);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//----------------------------------------------------------</span></span><br><span class="line">    <span class="comment">// Perform a synchronous search of fabrikam.com for </span></span><br><span class="line">    <span class="comment">// all user objects that have a "person" category.</span></span><br><span class="line">    <span class="comment">//----------------------------------------------------------</span></span><br><span class="line">    ULONG errorCode = LDAP_SUCCESS;</span><br><span class="line">    LDAPMessage* pSearchResult;</span><br><span class="line">    PCHAR pMyFilter = <span class="string">"(&amp;(objectCategory=person)(objectClass=user))"</span>;</span><br><span class="line">    PCHAR pMyAttributes[<span class="number">6</span>];</span><br><span class="line"></span><br><span class="line">    pMyAttributes[<span class="number">0</span>] = <span class="string">"cn"</span>;</span><br><span class="line">    pMyAttributes[<span class="number">1</span>] = <span class="string">"company"</span>;</span><br><span class="line">    pMyAttributes[<span class="number">2</span>] = <span class="string">"department"</span>;</span><br><span class="line">    pMyAttributes[<span class="number">3</span>] = <span class="string">"telephoneNumber"</span>;</span><br><span class="line">    pMyAttributes[<span class="number">4</span>] = <span class="string">"memberOf"</span>;</span><br><span class="line">    pMyAttributes[<span class="number">5</span>] = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">    errorCode = ldap_search_sA(</span><br><span class="line">        pLdapConnection,    <span class="comment">// Session handle</span></span><br><span class="line">        pMyDN,              <span class="comment">// DN to start search</span></span><br><span class="line">        LDAP_SCOPE_SUBTREE, <span class="comment">// Scope</span></span><br><span class="line">        pMyFilter,          <span class="comment">// Filter</span></span><br><span class="line">        pMyAttributes,      <span class="comment">// Retrieve list of attributes</span></span><br><span class="line">        <span class="number">0</span>,                  <span class="comment">// Get both attributes and values</span></span><br><span class="line">        &amp;pSearchResult);    <span class="comment">// [out] Search results</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (errorCode != LDAP_SUCCESS)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"ldap_search_s failed with 0x%0lx \n"</span>, errorCode);</span><br><span class="line">        ldap_unbind_s(pLdapConnection);</span><br><span class="line">        <span class="keyword">if</span> (pSearchResult != <span class="literal">NULL</span>)</span><br><span class="line">            ldap_msgfree(pSearchResult);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"ldap_search succeeded \n"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//----------------------------------------------------------</span></span><br><span class="line">    <span class="comment">// Get the number of entries returned.</span></span><br><span class="line">    <span class="comment">//----------------------------------------------------------</span></span><br><span class="line">    ULONG numberOfEntries;</span><br><span class="line"></span><br><span class="line">    numberOfEntries = ldap_count_entries(</span><br><span class="line">        pLdapConnection,    <span class="comment">// Session handle</span></span><br><span class="line">        pSearchResult);     <span class="comment">// Search result</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (numberOfEntries == <span class="literal">NULL</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"ldap_count_entries failed with 0x%0lx \n"</span>, errorCode);</span><br><span class="line">        ldap_unbind_s(pLdapConnection);</span><br><span class="line">        <span class="keyword">if</span> (pSearchResult != <span class="literal">NULL</span>)</span><br><span class="line">            ldap_msgfree(pSearchResult);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"ldap_count_entries succeeded \n"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"The number of entries is: %d \n"</span>, numberOfEntries);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//----------------------------------------------------------</span></span><br><span class="line">    <span class="comment">// Loop through the search entries, get, and output the</span></span><br><span class="line">    <span class="comment">// requested list of attributes and values.</span></span><br><span class="line">    <span class="comment">//----------------------------------------------------------</span></span><br><span class="line">    LDAPMessage* pEntry = <span class="literal">NULL</span>;</span><br><span class="line">    PCHAR pEntryDN = <span class="literal">NULL</span>;</span><br><span class="line">    ULONG iCnt = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">char</span>* sMsg;</span><br><span class="line">    BerElement* pBer = <span class="literal">NULL</span>;</span><br><span class="line">    PCHAR pAttribute = <span class="literal">NULL</span>;</span><br><span class="line">    PCHAR* ppValue = <span class="literal">NULL</span>;</span><br><span class="line">    ULONG iValue = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (iCnt = <span class="number">0</span>; iCnt &lt; numberOfEntries; iCnt++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// Get the first/next entry.</span></span><br><span class="line">        <span class="keyword">if</span> (!iCnt)</span><br><span class="line">            pEntry = ldap_first_entry(pLdapConnection, pSearchResult);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            pEntry = ldap_next_entry(pLdapConnection, pEntry);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Output a status message.</span></span><br><span class="line">        sMsg = (!iCnt ? <span class="string">"ldap_first_entry"</span> : <span class="string">"ldap_next_entry"</span>);</span><br><span class="line">        <span class="keyword">if</span> (pEntry == <span class="literal">NULL</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">"%s failed with 0x%0lx \n"</span>, sMsg, LdapGetLastError());</span><br><span class="line">            ldap_unbind_s(pLdapConnection);</span><br><span class="line">            ldap_msgfree(pSearchResult);</span><br><span class="line">            <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">"%s succeeded\n"</span>, sMsg);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Output the entry number.</span></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"ENTRY NUMBER %i \n"</span>, iCnt);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Get the first attribute name.</span></span><br><span class="line">        pAttribute = ldap_first_attributeA(</span><br><span class="line">            pLdapConnection,   <span class="comment">// Session handle</span></span><br><span class="line">            pEntry,            <span class="comment">// Current entry</span></span><br><span class="line">            &amp;pBer);            <span class="comment">// [out] Current BerElement</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Output the attribute names for the current object</span></span><br><span class="line"><span class="comment">// and output values.</span></span><br><span class="line">        <span class="keyword">while</span> (pAttribute != <span class="literal">NULL</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// Output the attribute name.</span></span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">"     ATTR: %s"</span>, pAttribute);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Get the string values.</span></span><br><span class="line"></span><br><span class="line">            ppValue = ldap_get_valuesA(</span><br><span class="line">                pLdapConnection,  <span class="comment">// Session Handle</span></span><br><span class="line">                pEntry,           <span class="comment">// Current entry</span></span><br><span class="line">                pAttribute);      <span class="comment">// Current attribute</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// Print status if no values are returned (NULL ptr)</span></span><br><span class="line">            <span class="keyword">if</span> (ppValue == <span class="literal">NULL</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">": [NO ATTRIBUTE VALUE RETURNED]"</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Output the attribute values</span></span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                iValue = ldap_count_valuesA(ppValue);</span><br><span class="line">                <span class="keyword">if</span> (!iValue)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="built_in">printf</span>(<span class="string">": [BAD VALUE LIST]"</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="comment">// Output the first attribute value</span></span><br><span class="line">                    <span class="built_in">printf</span>(<span class="string">": %s"</span>, *ppValue);</span><br><span class="line"></span><br><span class="line">                    <span class="comment">// Output more values if available</span></span><br><span class="line">                    ULONG z;</span><br><span class="line">                    <span class="keyword">for</span> (z = <span class="number">1</span>; z &lt; iValue; z++)</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="built_in">printf</span>(<span class="string">", %s"</span>, ppValue[z]);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Free memory.</span></span><br><span class="line">            <span class="keyword">if</span> (ppValue != <span class="literal">NULL</span>)</span><br><span class="line">                ldap_value_freeA(ppValue);</span><br><span class="line">            ppValue = <span class="literal">NULL</span>;</span><br><span class="line">            ldap_memfreeA(pAttribute);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Get next attribute name.</span></span><br><span class="line">            pAttribute = ldap_next_attributeA(</span><br><span class="line">                pLdapConnection,   <span class="comment">// Session Handle</span></span><br><span class="line">                pEntry,            <span class="comment">// Current entry</span></span><br><span class="line">                pBer);             <span class="comment">// Current BerElement</span></span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">"\n"</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (pBer != <span class="literal">NULL</span>)</span><br><span class="line">            ber_free(pBer, <span class="number">0</span>);</span><br><span class="line">        pBer = <span class="literal">NULL</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//----------------------------------------------------------</span></span><br><span class="line">    <span class="comment">// Normal cleanup and exit.</span></span><br><span class="line">    <span class="comment">//----------------------------------------------------------</span></span><br><span class="line">    ldap_unbind(pLdapConnection);</span><br><span class="line">    ldap_msgfree(pSearchResult);</span><br><span class="line">    ldap_value_freeA(ppValue);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (argc != <span class="number">3</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"Usage: LDAPTest.exe username password\n"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    MyLDAPSearch(argv[<span class="number">1</span>], argv[<span class="number">2</span>]);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="DCShadow"><a href="#DCShadow" class="headerlink" title="DCShadow"></a>DCShadow</h2><p><a href="https://blog.riskivy.com/dcshadow/" target="_blank" rel="noopener">揭秘DCShadow</a></p>
<h1 id="相关书籍"><a href="#相关书籍" class="headerlink" title="相关书籍"></a>相关书籍</h1><p>《内网安全攻防：渗透测试实战指南》</p>

      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2020/12/24/hello-world/" rel="next" title="Hello World">
                <i class="fa fa-chevron-left"></i> Hello World
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2020/12/28/mimikatz源码分析/" rel="prev" title="mimikatz源码分析">
                mimikatz源码分析 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">sup817ch</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">17</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              

              
            </nav>
          

          

          

          
          

          
          

          
            
          
          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#什么是域？"><span class="nav-number">1.</span> <span class="nav-text">什么是域？</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#域环境搭建"><span class="nav-number">2.</span> <span class="nav-text">域环境搭建</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Windows安全认证机制"><span class="nav-number">3.</span> <span class="nav-text">Windows安全认证机制</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#维基"><span class="nav-number">3.1.</span> <span class="nav-text">维基</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#其他资料"><span class="nav-number">3.2.</span> <span class="nav-text">其他资料</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Mimikatz"><span class="nav-number">4.</span> <span class="nav-text">Mimikatz</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Mimikatz能做什么"><span class="nav-number">4.1.</span> <span class="nav-text">Mimikatz能做什么</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Mimikatz-github"><span class="nav-number">4.2.</span> <span class="nav-text">Mimikatz github</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#其他资料-1"><span class="nav-number">4.3.</span> <span class="nav-text">其他资料</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#LDAP"><span class="nav-number">5.</span> <span class="nav-text">LDAP</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#什么是LDAP"><span class="nav-number">5.1.</span> <span class="nav-text">什么是LDAP</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Searching-a-Directory"><span class="nav-number">5.2.</span> <span class="nav-text">Searching a Directory</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#DCShadow"><span class="nav-number">5.3.</span> <span class="nav-text">DCShadow</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#相关书籍"><span class="nav-number">6.</span> <span class="nav-text">相关书籍</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2021</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">sup817ch</span>

  

  
</div>


  



  <div class="powered-by">由 <a class="theme-link" target="_blank" rel="external nofollow" href="https://hexo.io">Hexo</a> 强力驱动 v3.7.1</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" rel="external nofollow" href="https://github.com/theme-next/hexo-theme-next">NexT.Pisces</a> v6.3.0</div>




        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=6.3.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=6.3.0"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=6.3.0"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=6.3.0"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=6.3.0"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=6.3.0"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=6.3.0"></script>



  



	





  





  










  





  

  

  
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>


  

  
  

  

  

  

  

  

</body>
</html>
