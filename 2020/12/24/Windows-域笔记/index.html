<!DOCTYPE html>












  


<html class="theme-next pisces use-motion" lang="zh-CN">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2"/>
<meta name="theme-color" content="#222">












<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />






















<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=6.3.0" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=6.3.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=6.3.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=6.3.0">


  <link rel="mask-icon" href="/images/logo.svg?v=6.3.0" color="#222">









<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '6.3.0',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="本篇介绍一些基础概念和相关知识">
<meta property="og:type" content="article">
<meta property="og:title" content="Windows 域笔记">
<meta property="og:url" content="http://sup817ch.github.io/2020/12/24/Windows-域笔记/index.html">
<meta property="og:site_name" content="sup817ch&#39;s blog">
<meta property="og:description" content="本篇介绍一些基础概念和相关知识">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="https://blogvaronis2.wpengine.com/wp-content/uploads/2018/12/what-can-mimikatz-do@2x-1-960x669.png">
<meta property="og:updated_time" content="2020-12-25T10:13:11.638Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Windows 域笔记">
<meta name="twitter:description" content="本篇介绍一些基础概念和相关知识">
<meta name="twitter:image" content="https://blogvaronis2.wpengine.com/wp-content/uploads/2018/12/what-can-mimikatz-do@2x-1-960x669.png">






  <link rel="canonical" href="http://sup817ch.github.io/2020/12/24/Windows-域笔记/"/>



<script type="text/javascript" id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>Windows 域笔记 | sup817ch's blog</title>
  









  <noscript>
  <style type="text/css">
    .use-motion .motion-element,
    .use-motion .brand,
    .use-motion .menu-item,
    .sidebar-inner,
    .use-motion .post-block,
    .use-motion .pagination,
    .use-motion .comments,
    .use-motion .post-header,
    .use-motion .post-body,
    .use-motion .collection-title { opacity: initial; }

    .use-motion .logo,
    .use-motion .site-title,
    .use-motion .site-subtitle {
      opacity: initial;
      top: initial;
    }

    .use-motion {
      .logo-line-before i { left: initial; }
      .logo-line-after i { right: initial; }
    }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">sup817ch's blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">
    <a href="/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-home"></i> <br />首页</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-about">
    <a href="/about/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-user"></i> <br />关于</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">
    <a href="/archives/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />归档</a>
  </li>

      
      
    </ul>
  

  

  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://sup817ch.github.io/2020/12/24/Windows-域笔记/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="sup817ch">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="sup817ch's blog">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">Windows 域笔记
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2020-12-24 11:09:26" itemprop="dateCreated datePublished" datetime="2020-12-24T11:09:26+08:00">2020-12-24</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2020-12-25 18:13:11" itemprop="dateModified" datetime="2020-12-25T18:13:11+08:00">2020-12-25</time>
              
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>本篇介绍一些基础概念和相关知识</p>
<a id="more"></a>
<h1 id="什么是域？"><a href="#什么是域？" class="headerlink" title="什么是域？"></a>什么是域？</h1><p>Windows域通常用于大型网络——公司网络、学校网络和政府网络。除非你有雇主或学校提供的笔记本电脑，否则你在家里不会遇到这种情况。</p>
<p>典型的家用计算机是一个孤立的实体。您可以控制计算机上的设置和用户帐户。连接到域的计算机是不同的——这些设置是在<strong>域控制器(DC, domain controller)</strong> 上控制的。</p>
<p>Windows域为网络管理员提供了一种方法来管理大量的pc机，并从一个地方控制它们。一个或多个服务器(称为域控制器)控制域及其上的计算机。</p>
<p>域通常由在同一本地网络上的计算机组成。但是，连接到某个域的计算机可以通过VPN或Internet连接继续与域控制器通信。这使得企业和学校能够远程管理他们提供给员工和学生的笔记本电脑。</p>
<p>当计算机连接到一个域时，它不会使用自己的本地用户帐户，用户帐户和密码都是在域控制器上统一管理。当您登录到该域中的计算机时，计算机将使用域控制器验证您的用户帐户名称和密码。这意味着您可以在任何连接到该域的计算机上使用相同的用户名和密码登录。</p>
<p>网络管理员可以更改“域控制器”上的组策略设置。域上的每台计算机将从“域控制器”获得这些设置，它们将覆盖用户在其pc上指定的任何本地设置。所有的设置都是从一个地方控制的。这也“锁定”了计算机。您可能不允许更改连接到域的计算机上的许多系统设置。</p>
<h1 id="域环境搭建"><a href="#域环境搭建" class="headerlink" title="域环境搭建"></a>域环境搭建</h1><p><a href="http://blog.sina.com.cn/s/blog_6ce0f2c901014okt.html" target="_blank" rel="noopener">http://blog.sina.com.cn/s/blog_6ce0f2c901014okt.html</a></p>
<p><a href="http://www.it165.net/os/html/201306/5493.html" target="_blank" rel="noopener">http://www.it165.net/os/html/201306/5493.html</a></p>
<h1 id="Windows安全认证机制"><a href="#Windows安全认证机制" class="headerlink" title="Windows安全认证机制"></a>Windows安全认证机制</h1><p>Windows安全认证机制主要有两种：NTLM和Kerberos</p>
<p>基于ntlm的认证方式,主要用在早期的windows工作组环境中,认证的过程也相对比较简单。</p>
<p>另一种是基于Kerberos的认证方式,主要用在域环境中。</p>
<p><a href="https://zh.wikipedia.org/wiki/Windows_2000" target="_blank" rel="noopener">Windows 2000</a>和后续的操作系统使用Kerberos为其默认认证方法。<a href="https://tools.ietf.org/html/rfc3244" target="_blank" rel="noopener">RFC 3244</a> “微软Windows 2000 Kerberos变更密码与设置密码协议” 记录整理一些<a href="https://zh.wikipedia.org/wiki/微软" target="_blank" rel="noopener">微软</a>对Kerberos协议软件包的添加。<a href="https://tools.ietf.org/html/rfc4757" target="_blank" rel="noopener">RFC 4757</a> 记录整理微软对<a href="https://zh.wikipedia.org/wiki/RC4" target="_blank" rel="noopener">RC4</a>密码的使用。虽然微软使用Kerberos协议，却并没有用麻省理工的软件。</p>
<p>维基：</p>
<p><a href="https://en.wikipedia.org/wiki/NT_LAN_Manager" target="_blank" rel="noopener">https://en.wikipedia.org/wiki/NT_LAN_Manager</a></p>
<p><a href="https://zh.wikipedia.org/wiki/Kerberos" target="_blank" rel="noopener">https://zh.wikipedia.org/wiki/Kerberos</a></p>
<p>其他资料：</p>
<p><a href="https://www.zhihu.com/question/22177404" target="_blank" rel="noopener">能用通用的语言介绍下 Kerberos 协议么？</a>（通俗解释）</p>
<p><a href="https://www.varonis.com/blog/kerberos-authentication-explained/" target="_blank" rel="noopener">Kerberos Authentication Explained</a></p>
<p><a href="https://blog.csdn.net/wulantian/article/details/42418231" target="_blank" rel="noopener">kerberos认证原理</a></p>
<p><a href="https://attack.mitre.org/techniques/T1558/" target="_blank" rel="noopener">Steal or Forge Kerberos Tickets</a> （对Kerberos的一些攻击方式）</p>
<p><a href="https://www.cnblogs.com/artech/archive/2011/01/24/kerberos.html" target="_blank" rel="noopener">Windows安全认证是如何进行的？[Kerberos篇]</a></p>
<p><a href="https://www.cnblogs.com/artech/archive/2011/01/25/NTLM.html" target="_blank" rel="noopener">Windows安全认证是如何进行的？[NTLM篇]</a></p>
<p><a href="https://daiker.gitbook.io/windows-protocol/" target="_blank" rel="noopener">windows protocol</a>（对Kerberos、NTLM、LDAP的一些介绍，比较详细，可以多看看）</p>
<h1 id="Mimikatz"><a href="#Mimikatz" class="headerlink" title="Mimikatz"></a>Mimikatz</h1><p>Mimikatz是一款开源应用程序，允许用户查看和保存Kerberos tickets之类的身份验证凭据。本杰明·德尔皮（Benjamin Delpy）继续领导Mimikatz的开发，因此该工具集可与当前版本的Windows配合使用，并包括最新的攻击。</p>
<p><strong>Mimikatz能做什么</strong></p>
<ul>
<li><strong>Pass-the-Hash:</strong> Windows used to <a href="https://www.varonis.com/blog/windows-10-authentication-the-end-of-pass-the-hash/" target="_blank" rel="noopener">store password data in an NTLM hash</a>. Attackers use Mimikatz to pass that exact hash string to the target computer to login. Attackers don’t even need to crack the password, they just need to use the hash string as is. It’s the equivalent of finding the master key to a building on the floor. You need that one key to get into all the doors.</li>
<li><strong>Pass-the-Ticket:</strong> Newer versions of windows store password data in a construct called a ticket.  Mimikatz provides functionality for a user to pass a kerberos ticket to another computer and login with that user’s ticket. It’s basically the same as pass-the-hash otherwise.</li>
<li><strong>Over-Pass the Hash (Pass the Key):</strong> Yet another flavor of the pass-the-hash, but this technique passes a unique key to impersonate a user you can obtain from a domain controller.</li>
<li><strong>Kerberos Golden Ticket:</strong> This is a pass-the-ticket attack, but it’s a specific ticket for a hidden account called KRBTGT, which is the account that encrypts all of the other tickets. A <a href="https://www.varonis.com/blog/kerberos-how-to-stop-golden-tickets/" target="_blank" rel="noopener">golden ticket</a> gives you domain admin credentials to any computer on the network that doesn’t expire.</li>
<li><strong>Kerberos Silver Ticket:</strong> Another pass-the-ticket, but a <a href="https://www.varonis.com/blog/kerberos-attack-silver-ticket/" target="_blank" rel="noopener">silver ticket</a> takes advantage of a feature in Windows that makes it easy for you to use services on the network. Kerberos grants a user a TGS ticket, and a user can use that ticket to log into any services on the network. Microsoft doesn’t always check a TGS after it’s issued, so it’s easy to slip it past any safeguards.</li>
<li><strong>Pass-the-Cache:</strong> Finally an attack that doesn’t take advantage of Windows! A pass-the-cache attack is generally the same as a pass-the-ticket, but this one uses the saved and encrypted login data on a Mac/UNIX/Linux system.</li>
</ul>
<p><img src="https://blogvaronis2.wpengine.com/wp-content/uploads/2018/12/what-can-mimikatz-do@2x-1-960x669.png" alt=""></p>
<p>Mimikatz github: </p>
<p><a href="https://github.com/gentilkiwi/mimikatz" target="_blank" rel="noopener">https://github.com/gentilkiwi/mimikatz</a></p>
<p>其他资料：</p>
<p><a href="https://www.varonis.com/blog/what-is-mimikatz/" target="_blank" rel="noopener">What is Mimikatz: The Beginner’s Guide</a></p>
<p><a href="https://www.cnblogs.com/-mo-/p/11890232.html" target="_blank" rel="noopener">[后渗透]Mimikatz使用大全</a></p>
<p><a href="https://www.freebuf.com/articles/web/176796.html" target="_blank" rel="noopener">九种姿势运行Mimikatz</a>（包含了一些绕过杀软的手段）</p>
<p><a href="https://www.anquanke.com/post/id/180126" target="_blank" rel="noopener">深入分析Mimikatz：WDigest</a></p>
<p><a href="https://www.freebuf.com/articles/terminal/80186.html" target="_blank" rel="noopener">刨根问底：Hash传递攻击原理探究</a></p>
<p><a href="https://adsecurity.org/?page_id=1821" target="_blank" rel="noopener">Unofficial Guide to Mimikatz &amp; Command Reference</a>（介绍了mimikatz的使用方法和检测方法）</p>
<h1 id="相关书籍"><a href="#相关书籍" class="headerlink" title="相关书籍"></a>相关书籍</h1><p>《内网安全攻防：渗透测试实战指南》</p>

      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2020/12/24/hello-world/" rel="next" title="Hello World">
                <i class="fa fa-chevron-left"></i> Hello World
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">sup817ch</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">16</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              

              
            </nav>
          

          

          

          
          

          
          

          
            
          
          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#什么是域？"><span class="nav-number">1.</span> <span class="nav-text">什么是域？</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#域环境搭建"><span class="nav-number">2.</span> <span class="nav-text">域环境搭建</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Windows安全认证机制"><span class="nav-number">3.</span> <span class="nav-text">Windows安全认证机制</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Mimikatz"><span class="nav-number">4.</span> <span class="nav-text">Mimikatz</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#相关书籍"><span class="nav-number">5.</span> <span class="nav-text">相关书籍</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">sup817ch</span>

  

  
</div>


  



  <div class="powered-by">由 <a class="theme-link" target="_blank" rel="external nofollow" href="https://hexo.io">Hexo</a> 强力驱动 v3.7.1</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" rel="external nofollow" href="https://github.com/theme-next/hexo-theme-next">NexT.Pisces</a> v6.3.0</div>




        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=6.3.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=6.3.0"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=6.3.0"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=6.3.0"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=6.3.0"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=6.3.0"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=6.3.0"></script>



  



	





  





  










  





  

  

  
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>


  

  
  

  

  

  

  

  

</body>
</html>
